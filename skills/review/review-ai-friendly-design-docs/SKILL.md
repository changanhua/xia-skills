---
name: review-ai-friendly-design-docs
description: 按照《面向低端AI模型的代码生成友好型设计文档编写指南》审查设计文档。检查数据模型表格化、接口精确性、业务逻辑步骤化、异常枚举、关键约束显式声明等AI友好特性。适用于架构设计、技术方案、功能规范等文档的AI可实施性审查。
---

# When to use

- 审查需要交给AI模型生成代码的设计文档
- 在AI代码生成前验证文档的"AI友好度"
- 检查现有设计文档是否符合AI可实施性标准
- 评估文档能否降低AI误解、遗忘、幻觉的概率

# When NOT to use

- 纯代码实现审查（应使用 code review）
- 文档格式校对（语法、格式检查）
- 已确认AI可实施的文档的常规审查（使用 review-design-docs）

---

# Inputs required from user

- **文档路径**：需要审查的文档路径（必填）
- **审查重点**：是否有特别关注的部分（可选）

---

# Workflow

## 步骤 1：读取文档并识别结构

1. 使用 read_file 工具读取目标文档
2. 识别文档包含的模块：
   - 项目概述
   - 技术栈与依赖
   - 数据模型定义
   - 接口定义
   - 业务逻辑说明
   - 异常与边界条件
   - 关键约束说明
   - 伪代码流程
   - 测试用例

## 步骤 2：检查技术栈显式声明

检查是否显式声明了技术栈（不能使用模糊描述）：

| 检查项 | AI友好写法 | 应避免的写法 |
|--------|-----------|-------------|
| 语言 | Java 17 | 常见Java版本 |
| 框架 | Spring Boot 3.1 | 常用后端框架 |
| ORM | MyBatis | ORM框架 |
| 数据库 | MySQL 8.0 | 关系型数据库 |
| 构建工具 | Maven | 构建工具 |

**如果文档缺少技术栈声明**：标记为高风险，AI可能随意猜测。

## 步骤 3：检查数据模型定义

检查是否使用表格定义数据结构：

| 检查项 | AI友好写法 | 应避免的写法 |
|--------|-----------|-------------|
| 字段定义 | 表格（字段名、类型、必填、默认值、说明） | 自然语言描述 |
| 枚举值 | 显式枚举（0=DISABLED, 1=ACTIVE） | "状态字段" |
| 约束 | 明确主键、索引、唯一约束 | 未说明 |

**如果数据模型用自然语言描述**：标记为高风险，AI可能误解字段类型。

## 步骤 4：检查接口定义

检查接口是否精确（不能模糊）：

| 检查项 | AI友好写法 | 应避免的写法 |
|--------|-----------|-------------|
| HTTP方法 | POST /api/users | 创建用户接口 |
| 请求参数 | 表格（字段、类型、必填、示例） | 请求参数 |
| 返回结构 | JSON结构示例 | 返回成功或失败 |
| 错误码 | 明确错误码定义 | 错误处理 |

**如果接口描述模糊**：标记为高风险，AI可能生成不匹配的接口。

## 步骤 5：检查业务逻辑描述

检查是否使用步骤化或伪代码描述（不能省略关键步骤）：

**AI友好写法示例：**
```
创建用户流程：
步骤1：校验username不为空
步骤2：校验username唯一
步骤3：密码加密（BCrypt）
步骤4：保存数据库
步骤5：返回用户ID
```

或伪代码：
```
if username is empty:
    return error 4001
if exists(username):
    return error 4002
encrypted = bcrypt(password)
save(user)
return success(user.id)
```

**应避免的写法：**
> 创建用户时需要做一些校验，然后保存数据库

（模型会漏步骤）

## 步骤 6：检查异常与边界条件

检查是否枚举了错误场景：

| 检查项 | AI友好写法 | 应避免的写法 |
|--------|-----------|-------------|
| 错误码 | 4001: 用户名为空 | 需要考虑异常情况 |
| 处理方式 | 返回错误/记录日志 | 异常处理 |
| 事务 | 明确指定事务范围 | 未说明事务 |

**如果只写"需要考虑异常"**：标记为高风险，AI默认走理想路径。

## 步骤 7：检查关键约束

检查是否显式列出关键约束：

必须包含的约束类型：
- 唯一性约束（如：username 必须唯一）
- 格式约束（如：密码长度>=8）
- 并发约束（如：并发创建必须保证唯一性）
- 事务约束（如：使用Spring事务）
- 技术约束（如：不允许使用JPA）

## 步骤 8：检查模块化程度

检查是否模块化拆分：

- 每个模块单独成节（数据模型、接口、业务逻辑分开）
- 不混写（不把数据结构和逻辑混在一起）

---

# Output format

审查完成后，按以下格式输出：

```
## AI友好型设计文档审查报告

### 基本信息
- 文档路径: xxx
- 审查日期: xxx

### AI可实施性评估

#### 1. 技术栈声明 (X/10)
- [ ] 显式声明语言版本
- [ ] 显式声明框架版本
- [ ] 显式声明数据库版本
- 问题: xxx

#### 2. 数据模型 (X/10)
- [ ] 使用表格定义字段
- [ ] 定义枚举值
- [ ] 明确主键/索引/约束
- 问题: xxx

#### 3. 接口定义 (X/10)
- [ ] 明确HTTP方法+URL
- [ ] 请求参数表格
- [ ] 返回结构JSON示例
- [ ] 错误码定义
- 问题: xxx

#### 4. 业务逻辑 (X/10)
- [ ] 步骤化描述
- [ ] 或包含伪代码
- [ ] 无逻辑跳跃
- 问题: xxx

#### 5. 异常处理 (X/10)
- [ ] 枚举错误场景
- [ ] 明确错误码
- [ ] 指定事务范围
- 问题: xxx

#### 6. 关键约束 (X/10)
- [ ] 列出唯一性约束
- [ ] 列出格式约束
- [ ] 列出并发约束
- [ ] 列出技术约束
- 问题: xxx

#### 7. 模块化程度 (X/10)
- [ ] 模块单独成节
- [ ] 数据与逻辑分离

### 风险评估

| 风险级别 | 问题描述 | 后果 | 建议 |
|----------|----------|------|------|
| 高 | xxx | AI可能xxx | 建议xxx |
| 中 | xxx | AI可能xxx | 建议xxx |
| 低 | xxx | AI可能xxx | 建议xxx |

### 总体评价

- AI可实施性评分: X/100
- 一次生成成功率预测: 低/中/高

### 改进建议（按优先级）

1. [P0] 必须修复：xxx
2. [P1] 建议修复：xxx
3. [P2] 可选优化：xxx
```

---

# Examples

## Example 1: 审查context-management.md

用户输入：
```
请审查 plans/context-management.md 的AI友好度
```

执行流程：
1. 读取文档
2. 检查技术栈是否显式声明（当前是什么技术栈？）
3. 检查数据模型是否表格化
4. 检查接口是否精确
5. 检查业务逻辑是否步骤化
6. 输出评估报告

## Example 2: 审查新建文档

用户输入：
```
请审查我新写的设计文档 doc/new-feature.md
```

执行流程：
1. 读取文档
2. 对照AI友好度检查清单逐项评估
3. 输出具体的改进建议

---

# Troubleshooting

- **文档不存在**：检查路径是否正确
- **文档格式非Markdown**：建议转换为Markdown以便检查
- **文档过大**：分段读取，重点检查数据模型和接口部分
- **混合多种类型内容**：分别评估各模块的AI友好度
